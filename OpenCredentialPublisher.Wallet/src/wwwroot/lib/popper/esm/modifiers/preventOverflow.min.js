import{top,left,right,bottom,start}from"../enums.js";import getBasePlacement from"../utils/getBasePlacement.js";import getMainAxisFromPlacement from"../utils/getMainAxisFromPlacement.js";import getAltAxis from"../utils/getAltAxis.js";import within from"../utils/within.js";import getLayoutRect from"../dom-utils/getLayoutRect.js";import getOffsetParent from"../dom-utils/getOffsetParent.js";import detectOverflow from"../utils/detectOverflow.js";import getVariation from"../utils/getVariation.js";import getFreshSideObject from"../utils/getFreshSideObject.js";import{max as mathMax,min as mathMin}from"../utils/math.js";function preventOverflow(t){var e=t.state,i=t.options,r=t.name,a=i.mainAxis,o=void 0===a||a,s=i.altAxis,m=void 0!==s&&s,n=i.boundary,f=i.rootBoundary,l=i.altBoundary,p=i.padding,d=i.tether,g=void 0===d||d,c=i.tetherOffset,h=void 0===c?0:c,u=detectOverflow(e,{boundary:n,rootBoundary:f,padding:p,altBoundary:l}),w=getBasePlacement(e.placement),v=getVariation(e.placement),x=!v,j=getMainAxisFromPlacement(w),y=getAltAxis(j),O=e.modifiersData.popperOffsets,A=e.rects.reference,b=e.rects.popper,M="function"==typeof h?h(Object.assign({},e.rects,{placement:e.placement})):h,P={x:0,y:0};if(O){if(o||m){var B="y"===j?top:left,D="y"===j?bottom:right,F="y"===j?"height":"width",L=O[j],R=O[j]+u[B],S=O[j]-u[D],V=g?-b[F]/2:0,q=v===start?A[F]:b[F],E=v===start?-b[F]:-A[F],I=e.elements.arrow,T=g&&I?getLayoutRect(I):{width:0,height:0},k=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject(),z=k[B],C=k[D],G=within(0,A[F],T[F]),H=x?A[F]/2-V-G-z-M:q-G-z-M,J=x?-A[F]/2+V+G+C+M:E+G+C+M,K=e.elements.arrow&&getOffsetParent(e.elements.arrow),N=K?"y"===j?K.clientTop||0:K.clientLeft||0:0,Q=e.modifiersData.offset?e.modifiersData.offset[e.placement][j]:0,U=O[j]+H-Q-N,W=O[j]+J-Q;if(o){var X=within(g?mathMin(R,U):R,L,g?mathMax(S,W):S);O[j]=X,P[j]=X-L}if(m){var Y="x"===j?top:left,Z="x"===j?bottom:right,$=O[y],_=$+u[Y],tt=$-u[Z],et=within(g?mathMin(_,U):_,$,g?mathMax(tt,W):tt);O[y]=et,P[y]=et-$}}e.modifiersData[r]=P}}export default{name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};